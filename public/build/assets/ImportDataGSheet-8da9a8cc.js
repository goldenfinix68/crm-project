import{aC as Q,I as l,r as p,aQ as _,K as k,J as e,M as g,a2 as N,b_ as j,bk as w,$ as s,W as d,N as E,a4 as P,Z as L,U as T,V as b,T as K,cc as z,aY as W,a8 as H,A as Y,aa as x,L as J,ab as Z}from"./app-e91fb682.js";import{f as B}from"./useContactMutation-bc41184e.js";import{g as X,I as $}from"./ImportDataGSheetHeader-26f86942.js";const ne=()=>{const R=Q(),[n]=l.useForm(),C=l.useWatch("isAddToQueue",n),[h,G]=p.useState(void 0),[M,f]=p.useState(!1),{data:o,isLoading:ee}=X(),A=l.useWatch("gSheedId",n),O=l.useWatch("gSheetName",n),[r,V]=p.useState({}),[I,D]=p.useState(null),{data:i}=_("contact"),c=i==null?void 0:i.filter(t=>t.isRequired&&!["contactLookup","userLookup","contactTypeLookup"].includes(t.type)),y=k(B,{onSuccess:()=>{J.invalidateQueries("gSheetCrawlResults"),R("/setup/data-administration/import-file-gsheet/history")},onError:t=>{console.log(t.message||"An error occurred")}}),S=k(Z,{onSuccess:t=>{if(t.result){const a=t.data;G(Object.entries(a))}else x.error(t.message)}}),q=async()=>{const t=c==null?void 0:c.every(a=>Object.values(r).some(u=>u==a.id));console.log(r),n.setFieldsValue(I),t?y.mutate({...I,columnMappings:r}):x.error((c==null?void 0:c.map(a=>a.label).join(", "))+" required.")},F=(t,a)=>{V({...r,[t]:a})},v=Object.values(r).filter((t,a,u)=>u.indexOf(t)!==a).length>0;return p.useEffect(()=>{o!=null&&o.id&&(n.setFieldValue("gSheedId",o.gSheetId),n.setFieldValue("interval",o.interval),n.setFieldValue("isAddToQueue",!0))},[o]),console.log({columnMappings:r}),e.createElement(g,{direction:"vertical",className:"w-100"},e.createElement($,null),h!=null&&h.length?e.createElement(N,{title:"Map columns from sheet to Speedlead fields",className:"w-100"},v&&e.createElement(j,{description:"Same field selected for mapping.",type:"error"}),e.createElement(w,{dataSource:h,pagination:!1},e.createElement(w.Column,{title:"File Columns",key:"column1",render:([t,a])=>e.createElement(g,{direction:"vertical"},e.createElement(s.Text,null,t),e.createElement(s.Text,{style:{fontSize:"9px"}},String(a)))}),e.createElement(w.Column,{title:"Speedlead Fields",key:"column2",render:([t,a])=>{var u;return e.createElement(d,{showSearch:!0,className:"w-100",value:r[t]??"",onChange:m=>{F(t,m)},allowClear:!0,optionFilterProp:"children"},(u=i==null?void 0:i.filter(m=>!["contactLookup","userLookup","contactTypeLookup"].includes(m.type)))==null?void 0:u.map((m,U)=>e.createElement(d.Option,{value:m.id,key:U},m.label)))}})),e.createElement(g,{className:"p-t-lg"},e.createElement(E,{type:"primary",onClick:()=>{q()},disabled:v,loading:S.isLoading||y.isLoading},C?"Crawl and Save":"Crawl"))):e.createElement(N,null,e.createElement(s.Title,{level:3},"Import from Google Sheet"),e.createElement(s,{className:"m-b-sm"},"Now, you have the capability to effortlessly import contacts directly from a Google Sheet. Additionally, you have the flexibility to set the frequency at which our system crawls the spreadsheet, ensuring seamless updates to your account by identifying and adding any new contacts as needed."),e.createElement(E,{type:"link",className:"p-0",onClick:()=>f(!0)},"Learn more about how to import using an google sheet."),e.createElement(P,null),e.createElement(L,{style:{display:"flex",justifyContent:"center"}},e.createElement(s.Title,{level:5},"Need help in getting started?")),e.createElement(L,{style:{display:"flex",justifyContent:"center"}},e.createElement(s.Link,{href:"https://docs.google.com/spreadsheets/d/1OOt8l719ev8VilpodHSaEvrKdXjt-edU0uDWT_hUFYw/edit?usp=sharing",target:"_blank"},"View sample spreadsheet"),e.createElement(s,{className:"m-r-sm m-l-sm"},"|"),e.createElement(s.Link,{href:"",target:"_blank"},"View import FAQs")),e.createElement(l,{layout:"vertical",form:n,className:"p-t-lg"},e.createElement(l.Item,{name:"gSheedId",label:"Google Sheet ID",rules:[{required:!0,message:T}]},e.createElement(b,null)),e.createElement(l.Item,{name:"gSheetName",label:"Sheet Name",rules:[{required:!0,message:T}]},e.createElement(b,null)),e.createElement(K,{title:"Get this in Roor Campaign -> Autoresponder -> Get posting Instruction."},e.createElement(l.Item,{name:"roorAutoresponderId",label:"Roor Autoresponder ID"},e.createElement(b,null))),C&&e.createElement(l.Item,{name:"interval",label:"Crawl interval",rules:[z.required],initialValue:"5"},e.createElement(d,{showSearch:!0},e.createElement(d.Option,{value:"5"},"5 Minutes"),e.createElement(d.Option,{value:"10"},"10 Minutes"),e.createElement(d.Option,{value:"15"},"15 Minutes"))),e.createElement(l.Item,{name:"isAddToQueue",valuePropName:"checked"},e.createElement(W,null,"Recurring crawl queue")),e.createElement(g,{style:{paddingTop:"5px"}},e.createElement(E,{type:"primary",onClick:()=>{n.validateFields().then(t=>{D(t),S.mutate({url:"/api/googlesheet/get-column-names",data:{gSheedId:A,gSheetName:O}})})},disabled:v,loading:S.isLoading||y.isLoading},"Next")))),e.createElement(H,{className:"modal-activity",open:M,onCancel:()=>{f(!1)},footer:null,title:null,closable:!1,width:"500px"},e.createElement("div",{className:"modal-header"},e.createElement(s.Title,{level:5,style:{color:"white"}},"Instruction"),e.createElement(E,{onClick:()=>{f(!1)},style:{backgroundColor:"rgba(0, 0, 0, 0.5)",border:"0px"},icon:e.createElement(Y,{style:{color:"white"}})})),e.createElement("ol",{className:"p-t-xl"},e.createElement("li",null,'Duplicate the "Speedlead sample spreadsheet" sheet'),e.createElement("li",null,"Verify that all required fields are present in the Google Sheet headers."),e.createElement("li",null,"Ensure that each required field has a corresponding value. (If any row fails to satisfy all required fields, the system will ignore it)"),e.createElement("li",null,"Share the newly created Google Sheet with the email address: pueblocrawler@pueblocrawler.iam.gserviceaccount.com."),e.createElement("li",null,"Retrieve the unique ID of the new Google Sheet from its URL. To do this:",e.createElement("ol",null,e.createElement("li",null,"Open the duplicated Google Sheet in your web browser"),e.createElement("li",null,"Copy the random string of characters from the URL in the address bar (ex."," ",e.createElement("b",null,"1MKweHrU_1pa4hZxkJzuCxEP2LiR5Lm3K9VNzlE7YTis"),"). The URL should look something like this: https://docs.google.com/spreadsheets/d/1MKweHrU_1pa4hZxkJzuCxEP2LiR5Lm3K9VNzlE7YTis/edit#gid=1183934613"))),e.createElement("li",null,'Paste the copied Google Sheet ID into the "Google Sheet ID input" field.'),e.createElement("li",null,"Set how frequent you want us to crawl the spreadsheet."))))};export{ne as default};
