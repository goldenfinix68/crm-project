import{r as n,B as N,_ as B,J as e,K as O,L as p,c4 as K,af as F,c5 as P,b0 as S,M as v,be as Q,T as j,c6 as G,az as _,bd as X,a2 as $,N as A,by as Z,R as ee,$ as q,c7 as te,c8 as le,c9 as se,I as T,a8 as ae,A as oe,ca as ne,W as R,cb as ie}from"./app-36fe48bb.js";import{C as H}from"./ConfirmModal-7e86a89b.js";import{u as V,a as Y}from"./useDrop-7efde422.js";import{T as U}from"./index-46242ecd.js";import{D as W}from"./DeleteOutlined-cb3dd239.js";var re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};const ce=re;var de=function(s,t){return n.createElement(N,B({},s,{ref:t,icon:ce}))};const ue=n.forwardRef(de);var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M511.4 124C290.5 124.3 112 303 112 523.9c0 128 60.2 242 153.8 315.2l-37.5 48c-4.1 5.3-.3 13 6.3 12.9l167-.8c5.2 0 9-4.9 7.7-9.9L369.8 727a8 8 0 00-14.1-3L315 776.1c-10.2-8-20-16.7-29.3-26a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-7.5 7.5-15.3 14.5-23.4 21.2a7.93 7.93 0 00-1.2 11.1l39.4 50.5c2.8 3.5 7.9 4.1 11.4 1.3C854.5 760.8 912 649.1 912 523.9c0-221.1-179.4-400.2-400.6-399.9z"}}]},name:"undo",theme:"outlined"};const fe=me;var pe=function(s,t){return n.createElement(N,B({},s,{ref:t,icon:fe}))};const Ce=n.forwardRef(pe),Ee=({id:f,index:s,customField:t,customFields:i,type:C})=>{var b;const[r,u]=n.useState(),[m,c]=e.useState(!1),[d,o]=n.useState(!1),[h,E]=n.useState(!1),[z,g]=n.useState(i),L=O(a=>K(a),{onSuccess:()=>{p.invalidateQueries("customFieldSections"),p.invalidateQueries("inactiveCustomFields"),o(!1)},onError:a=>{console.log(a.message||"An error occurred")}}),[,M]=V({type:"CUSTOM_FIELD",item:{id:f,index:s}}),[,k]=Y({accept:"CUSTOM_FIELD",drop:a=>{a.index!==s&&(I(a.index,s),a.index=s)}}),D=O(P,{onSuccess:()=>{p.invalidateQueries("customFieldSections"),F.success("Succesfully saved.")},onError:a=>{console.log(a.message||"An error occurred")}}),I=(a,x)=>{const l=[...i||[]],[y]=l.splice(a,1);l.splice(x,0,y),g(l),console.log(l),D.mutate(l)};return n.useEffect(()=>{g(i)},[i]),e.createElement(e.Fragment,null,e.createElement(S.Item,{key:t.id,style:{cursor:"move",width:"100%"},ref:a=>M(k(a))},e.createElement(S.Item.Meta,{title:e.createElement(v,null,e.createElement(Q,{className:"p-t-xs"}),t.label,t.isDefault?e.createElement(j,{title:"You can not edit or delete default field. However, you can still move it within its section."},e.createElement(ue,{style:{color:"gray"}})):null)}),e.createElement(v,null,t.isDefault?null:e.createElement(U,{color:"orange"},"Custom Field"),e.createElement(U,null,(b=G.find(a=>a.type==t.type))==null?void 0:b.label),t.isRequired?e.createElement(U,{color:"red"},"Required"):null,e.createElement(_,{style:{cursor:"pointer"},onClick:()=>{t.isDefault?F.error("Cannot edit default section"):(c(!0),u(t))}}),e.createElement(W,{style:{cursor:"pointer"},onClick:()=>{t.isDefault?F.error("Cannot delete default section"):(o(!0),u(t))}}))),r&&m&&e.createElement(X,{isModalOpen:m,closeModal:()=>c(!1),handleSubmit:()=>{console.log("qwe")},type:C,customField:r}),r&&d&&e.createElement(H,{title:"Confirm",message:`Are you sure you want to mark as inactive ${r.label}?`,handleNo:()=>o(!1),handleYes:async()=>{E(!0),await L.mutate(r.id),E(!1)},isOpen:d,loading:h}))},Oe=({id:f,index:s,card:t,type:i,sections:C})=>{const[r,u]=e.useState(!1),[m,c]=n.useState(),[d,o]=n.useState(!1),[h,E]=n.useState(!1),[z,g]=n.useState(!1),[L,M]=n.useState(),k=O(le,{onSuccess:()=>{p.invalidateQueries("customFieldSections"),F.success("Succesfully saved.")},onError:l=>{console.log(l.message||"An error occurred")}}),[,D]=V({type:"CARD",canDrag:l=>l.getItemType()!=="CUSTOM_FIELD",item:{id:f,index:s}}),[,I]=Y({accept:"CARD",drop:l=>{l.index!==s&&(b(l.index,s),l.index=s)}}),b=(l,y)=>{const w=[...L||[]],[J]=w.splice(l,1);w.splice(y,0,J),M(w),k.mutate(w)},a=()=>{o(!d)},x=O(l=>se(t.id),{onSuccess:()=>{p.invalidateQueries("customFieldSections"),E(!1)},onError:l=>{console.log(l.message||"An error occurred")}});return n.useEffect(()=>{M(C)},[C]),e.createElement(e.Fragment,null,e.createElement("div",{ref:l=>D(I(l)),style:{width:"100%"}},e.createElement($,{title:e.createElement("div",{ref:l=>D(I(l))},e.createElement(v,{style:{cursor:"move",width:"100%"}},e.createElement(Q,{className:"p-t-xs"}),t.name,e.createElement(A,{type:"text",icon:e.createElement("div",{className:"p-t-xs"},d?e.createElement(ee,null):e.createElement(Z,{size:15})),onClick:a}))),extra:e.createElement(v,null,e.createElement(q.Text,null,t.columnLayout=="one"?"One Column":"Two Column"),e.createElement(_,{style:{cursor:"pointer"},onClick:()=>{c(t),u(!0)}}),e.createElement(W,{style:{cursor:"pointer"},onClick:()=>{t.isDefault?F.error("Cannot delete default section"):E(!0)}})),bodyStyle:{padding:d?0:24}},d?null:e.createElement(S,{size:"small",header:!1,footer:!1,dataSource:t.fields,renderItem:(l,y)=>e.createElement(Ee,{customField:l,customFields:t.fields??[],index:y,key:l.id,id:t.id,type:i})}))),e.createElement(H,{title:"Confirm",message:`Are you sure you want to delete ${t==null?void 0:t.name}? All associated custom fields will be moved to inactive fields`,handleNo:()=>E(!1),handleYes:async()=>{g(!0),await x.mutate(t.id),g(!1)},isOpen:h,loading:z}),m&&e.createElement(te,{isModalOpen:r,closeModal:()=>u(!1),handleSubmit:()=>{console.log("qwe")},type:i,cutomFieldSection:m}))},he=({inactiveFields:f,sections:s})=>{const[t]=T.useForm(),[i,C]=n.useState(),[r,u]=e.useState(!1),m=O(ie,{onSuccess:()=>{p.invalidateQueries("customFieldSections"),p.invalidateQueries("inactiveCustomFields"),c()},onError:o=>{console.log(o.message||"An error occurred")}}),c=()=>{u(!1),t.resetFields()},d=async o=>{i&&await m.mutate({...i,customFieldSectionId:o.customFieldSectionId})};return e.createElement(e.Fragment,null,e.createElement($,{title:"Inactive fields"},e.createElement(S,{size:"small",header:!1,footer:!1,dataSource:f,renderItem:(o,h)=>e.createElement(S.Item,{key:o.id},e.createElement(S.Item.Meta,{title:o.label}),e.createElement(Ce,{style:{cursor:"pointer"},onClick:()=>{C(o),u(!0)}}))})),e.createElement(ae,{className:"modal-activity",open:r,onCancel:c,footer:null,title:null,closable:!1},e.createElement("div",{className:"modal-header"},e.createElement(q.Title,{level:5,style:{color:"white"}},"Restore Custom Field"),e.createElement(A,{onClick:c,style:{backgroundColor:"rgba(0, 0, 0, 0.5)",border:"0px"},icon:e.createElement(oe,{style:{color:"white"}})})),e.createElement(v,{direction:"vertical",style:{padding:"20px",width:"100%",paddingTop:"30px"},size:0},e.createElement(T,{name:"basic",layout:"vertical",labelWrap:!0,onFinish:d,autoComplete:"off",form:t,initialValues:{customFieldSectionId:s!=null&&s.length?s[0].id:""}},e.createElement(T.Item,{name:"customFieldSectionId",label:"Section Name",rules:[ne.required]},e.createElement(R,null,s==null?void 0:s.map(o=>e.createElement(R.Option,{value:o.id},o.name)))),e.createElement(v,{style:{paddingTop:"5px"}},e.createElement(A,{type:"primary",htmlType:"submit",loading:m.isLoading},"Save"),e.createElement(A,{onClick:c},"Cancel"))))))};export{Oe as D,he as I};
