<<<<<<<< HEAD:public/build/assets/TextBoxView-1663ce70.js
import{r as s,B as ae,_ as ne,K as Y,L as T,ab as Le,J as e,a5 as R,T as fe,a9 as Me,M as h,N as g,I as B,bM as Fe,bN as he,aQ as ve,aa as Ne,aO as Ae,a8 as le,$ as b,Z as q,Y as M,V as H,b1 as U,S as se,a1 as ee,ag as Oe,O as re,P as oe,aC as ce,ai as W,bu as D,bO as ze,aR as $e,bP as De,bQ as Re,A as ie,U as Be,aZ as x,ad as Ye,bR as _e,a6 as Pe,bS as Qe,aW as J,aY as G,aw as Ke,bT as Ve,aB as Ue,a4 as We,bU as Ge,bV as qe,bW as He,a2 as je}from"./app-5c564086.js";import{C as Ze}from"./ContactInfo-ca7993a5.js";import{T as te}from"./index-a1f97617.js";import{I as Je}from"./InboxOutlined-bea38814.js";import{D as xe}from"./DeleteOutlined-b0c3a123.js";import{C as Ee}from"./ConfirmModal-80a2b433.js";import{C as Xe}from"./ContactBulkUpdate-92525ae7.js";import{R as et}from"./RedoOutlined-d03173eb.js";import"./DropdownComponent-987802e7.js";import"./useContactMutation-c9e0ad0b.js";import"./ContactInfoEditableText-6aef1d15.js";import"./TextEllipsis-279ed56a.js";import"./index-9eb3e4b1.js";var tt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"};const at=tt;var nt=function(a,l){return s.createElement(ae,ne({},a,{ref:l,icon:at}))};const lt=s.forwardRef(nt);var st={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"};const rt=st;var ot=function(a,l){return s.createElement(ae,ne({},a,{ref:l,icon:rt}))};const ct=s.forwardRef(ot);var it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM699 387c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"}}]},name:"tag",theme:"filled"};const mt=it;var dt=function(a,l){return s.createElement(ae,ne({},a,{ref:l,icon:mt}))};const Ce=s.forwardRef(dt),ut=({name:i,text:a})=>{const l=Y(Le,{onSuccess:r=>{T.invalidateQueries("thread")}});return a.isFromApp?e.createElement("div",{style:{padding:"10px",display:"flex",alignItems:"center",flexDirection:"row-reverse"}},e.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"}},e.createElement("div",{style:{display:"flex",alignItems:"center",backgroundColor:"#D6EAFF",padding:"12px 24px",borderRadius:"20px 20px 0 20px"}},a.status=="failed"?e.createElement(fe,{title:a==null?void 0:a.errorMessage},e.createElement(lt,{style:{color:"red"}})):null,a.status=="scheduled"&&a.schedule?e.createElement(fe,{title:`Will be sent on ${R.utc(a.schedule).local().format("MMM DD, YYYY hh:mm A")}`},e.createElement(Me,null)):null,e.createElement("div",{className:"p-l-xs"},a.message)),e.createElement(h,{style:{marginTop:"8px",fontSize:"10px"},size:1},`${R.utc(a.created_at).local().format("MMM DD, YYYY hh:mm A")} ${a.to.replace(/^(\d{3})(\d{3})(\d{4})$/,"($1) $2-$3")}`,a.status=="failed"&&e.createElement(g,{className:"p-0",type:"text",style:{color:"red",cursor:"pointer",fontSize:"10px"},onClick:()=>{l.mutate({data:{id:a.id},url:"/api/texts/resend"})},loading:l.isLoading},"Re-try"),a.status=="queued"&&e.createElement("div",null,"(Sending)")))):e.createElement("div",{style:{padding:"10px",display:"flex",alignItems:"center"}},e.createElement("div",{style:{display:"flex",flexDirection:"column"}},e.createElement("div",{style:{backgroundColor:"white",padding:"12px 24px",borderRadius:"20px 20px 20px 0"}},a.message),e.createElement("div",{style:{marginTop:"8px",fontSize:"10px"}},`${a.from.replace(/^(\d{3})(\d{3})(\d{4})$/,"($1) $2-$3")} ${R.utc(a.created_at).local().format("MMM DD, YYYY hh:mm A")}`)))},pt=({isModalOpen:i,closeModal:a,handleSubmit:l,contactNumber:r})=>{const[d]=B.useForm(),[c,u]=s.useState(1),[o,C]=s.useState(void 0),[f,y]=s.useState(),[S,E]=s.useState(""),[t,F]=s.useState(!1),{data:I,refetch:_}=Fe({keyword:S},"/api/contacts/global-search","globalSearch",()=>{F(!1)}),N=he.debounce(()=>{_()},500);s.useEffect(()=>{I&&I.data&&y(I.data.data)},[I]);const{data:m,isLoading:A,refetch:Q}=ve("contact"),O=Y(Ae,{onSuccess:()=>{z(),l&&l()},onError:p=>{Ne.error(p.message||"An error occurred")}}),z=()=>{a(),d.resetFields()};return console.log({contactFields:m}),e.createElement(le,{title:e.createElement(b.Text,null,"Select Contact"),open:i,onCancel:z,className:"manage-column-field",footer:!1},c===1?e.createElement(e.Fragment,null,e.createElement(q,{gutter:12},e.createElement(M,{span:24},e.createElement(H,{placeholder:"Search Contact",className:"w-100",onChange:p=>{F(!0),E(p.target.value),N()}})),e.createElement(M,{span:24,className:"m-t-md"},e.createElement(U,{className:"field-list",size:"default",header:!1,footer:!1,bordered:!0},e.createElement(e.Fragment,null,t&&e.createElement("div",{style:{display:"grid",placeItems:"center",padding:"24px"}},e.createElement(se,null)),!t&&e.createElement(e.Fragment,null,f!=null&&f.length?f==null?void 0:f.map(p=>e.createElement("div",{className:"w-100",onClick:()=>{u(2),C(p)}},e.createElement(ye,{text:`${p.fields.firstName} ${p.fields.lastName}`}))):e.createElement(ee,{image:ee.PRESENTED_IMAGE_SIMPLE}))))))):e.createElement(e.Fragment,null,e.createElement(h,{className:"m-b-sm"},e.createElement(b.Text,{strong:!0},`Phone type fields of ${o==null?void 0:o.fields.firstName} ${o==null?void 0:o.fields.lastName}`),e.createElement(g,{type:"link",className:"p-l-none",onClick:()=>u(1)},"Change")),e.createElement(U,{className:"field-list",size:"large",header:!1,footer:!1,bordered:!0,dataSource:m==null?void 0:m.filter(p=>["phone","mobile"].includes(p.type)),renderItem:p=>e.createElement(Oe,{title:"Update Contact",description:`Are you sure you want to replace this field with ${r}?`,onConfirm:async()=>{await O.mutate({customableId:o==null?void 0:o.id,customableType:"contact",fields:{[p.fieldName]:r}})}},e.createElement("div",{className:"w-100"},e.createElement(ye,{text:p.label,subText:(o==null?void 0:o.fields[p.fieldName])??"Not set"})))})))},ye=({text:i,subText:a})=>e.createElement(e.Fragment,null,e.createElement(U.Item,{style:{cursor:"pointer"}},e.createElement(h,{direction:"vertical",size:0},e.createElement(b.Text,{strong:!0},i),e.createElement(b.Text,null,a??"")))),Se=()=>{const{data:i,isLoading:a}=re("textLabels",async()=>{const l=localStorage.getItem("access_token");return(await oe.get("/api/text-labels",{headers:{Authorization:`Bearer ${l}`}})).data},{staleTime:1/0});return{labels:i,isLoading:a}},gt=(i,a)=>{const{data:l,isLoading:r,refetch:d}=re("textThreads",async()=>{const c=localStorage.getItem("access_token");return(await oe.get("/api/text-threads",{headers:{Authorization:`Bearer ${c}`},params:i})).data},{staleTime:1/0,onSuccess:()=>{a&&a()}});return{data:l,isLoading:r,refetch:d}},ft=(i,a,l)=>{const{data:r,isLoading:d,isError:c,refetch:u}=re("thread",async()=>{try{const o=localStorage.getItem("access_token");return(await oe.get(`/api/text-threads/${i}?type=${a}`,{headers:{Authorization:`Bearer ${o}`}})).data}catch(o){throw new Error(`Error fetching text thread: ${o.message}`)}},{staleTime:1/0,onSuccess:o=>{l&&l(o)}});return{thread:r,isLoading:d,isError:c,refetch:u}},Et=({menu:i})=>{var A,Q,O,z,p;const a=ce(),[l,r]=s.useState(!1),[d,c]=e.useState(0),u=e.useRef(null),[o,C]=s.useState(!1),[f,y]=s.useState(!1),{threadId:S}=W(),{contactId:E}=W(),{thread:t,refetch:F,isLoading:I}=ft(E??S??"",E?"contact":"thread",v=>{r(!1)}),_=Y(De,{onSuccess:()=>{}});s.useEffect(()=>{!S&&!E?a("/text-threads"):(r(!0),F())},[S,E]),e.useEffect(()=>{t&&(_.mutate({id:E??S,type:E?"contact":"thread"}),document.title=t.contactName+" - SpeedLead")},[t]);const N=()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},m=t==null?void 0:t.texts[(t==null?void 0:t.texts.length)-1];return e.useEffect(()=>(N(),c(d+1),console.log("thread",t),()=>{}),[t]),["all","inbox","scheduled"].includes(i)?e.createElement(e.Fragment,null,l?e.createElement("div",{style:{display:"grid",placeItems:"center",marginTop:"50%"}},e.createElement(se,null)):e.createElement(q,{key:S},e.createElement(M,{span:13,style:{height:"85vh",overflowY:"auto"},ref:u},e.createElement("div",{style:{backgroundColor:"white",width:"100%",padding:"15px",display:"flex",alignItems:"center",position:"sticky",top:0,zIndex:1}},e.createElement(h,{direction:"vertical",size:0},(A=t==null?void 0:t.contact)!=null&&A.id?e.createElement(D,{to:"/contacts/"+((Q=t==null?void 0:t.contact)==null?void 0:Q.id)+"/"+t.contact.fields.firstName.replace(/\s/g,"-")+"-"+t.contact.fields.lastName.replace(/\s/g,"-")},e.createElement(b.Text,{strong:!0},t==null?void 0:t.contactName)):e.createElement(b.Text,{strong:!0},t==null?void 0:t.contactName),e.createElement(b.Text,null,t==null?void 0:t.phoneNumbers))),e.createElement("div",{style:{paddingTop:"150px",height:"85%"}},e.createElement("div",{style:{minHeight:"80%"}},(O=t==null?void 0:t.texts)==null?void 0:O.sort((v,k)=>parseInt(v.id??"0")-parseInt(k.id??"0")).map(v=>e.createElement(ut,{name:t==null?void 0:t.contactName,text:v,key:v.id}))),e.createElement("div",{style:{position:"sticky",bottom:0,left:0,width:"100%",backgroundColor:"white",padding:"10px"},key:d},e.createElement(ze,{handleSubmit:()=>{T.invalidateQueries("thread")},phoneNumbers:t!=null&&t.contact?(z=t==null?void 0:t.contact)==null?void 0:z.phoneNumbers:[t==null?void 0:t.phoneNumbers],defaultTo:m!=null&&m.isFromApp?m==null?void 0:m.to:m==null?void 0:m.from,defaultFrom:((p=t==null?void 0:t.contact)==null?void 0:p.defaultMobileNumber)??(m!=null&&m.isFromApp?m==null?void 0:m.from:m==null?void 0:m.to),contact:(t==null?void 0:t.contact)??void 0})))),e.createElement(M,{span:11,style:{height:"85vh",overflowY:"auto"}},e.createElement(h,{direction:"vertical",size:0,style:{width:"100%",overflowY:"auto"}},e.createElement("div",{style:{backgroundColor:"#F5F5F5",width:"100%",padding:"15px",display:"flex",fontWeight:"bold",height:"74px",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:"16px"}},"Related Information"),t!=null&&t.contact?e.createElement(Ze,{contact:t==null?void 0:t.contact}):e.createElement(h,{style:{textAlign:"center"},className:"w-100",size:"large",direction:"vertical"},"Number not saved in contacts",e.createElement(g,{onClick:()=>C(!0)},"Create Contact"),e.createElement(g,{onClick:()=>y(!0)},"Add to existing Contact")))),o&&e.createElement($e,{isModalOpen:o,closeModal:()=>{C(!1)},handleSubmit:()=>{T.invalidateQueries("textThreads"),T.invalidateQueries("thread")},type:"contact",record:{mobile:t==null?void 0:t.phoneNumbers}}),f&&e.createElement(pt,{isModalOpen:f,closeModal:()=>y(!1),handleSubmit:()=>{T.invalidateQueries("textThreads"),T.invalidateQueries("thread")},contactNumber:t==null?void 0:t.phoneNumbers}))):null},yt=({isModalOpen:i,closeModal:a,textLabel:l})=>{const[r]=B.useForm(),d=Y(Re,{onSuccess:()=>{T.invalidateQueries("textLabels"),a(),u()},onError:o=>{console.log(o.message||"An error occurred")}}),c=async o=>{await d.mutate({...o,id:l!=null&&l.id?l.id:""})},u=()=>{a(),r.resetFields()};return s.useEffect(()=>{l!=null&&l.name?r.setFieldValue("name",l.name):r.resetFields()},[l]),e.createElement(le,{className:"modal-activity",open:i,onCancel:a,footer:null,title:null,closable:!1},e.createElement("div",{className:"modal-header"},e.createElement(b.Title,{level:5,style:{color:"white"}},l?"Update":"Create new"," label"),e.createElement(g,{onClick:a,style:{backgroundColor:"rgba(0, 0, 0, 0.5)",border:"0px"},icon:e.createElement(ie,{style:{color:"white"}})})),e.createElement(h,{direction:"vertical",style:{padding:"20px",width:"100%",paddingTop:"30px"},size:0},e.createElement(B,{name:"basic",layout:"vertical",labelWrap:!0,onFinish:c,autoComplete:"off",form:r},e.createElement(B.Item,{name:"name",label:"Label name",rules:[{required:!0,message:Be}]},e.createElement(H,{placeholder:"Folder name"})),e.createElement(h,{style:{paddingTop:"5px"}},e.createElement(g,{type:"primary",htmlType:"submit",loading:d.isLoading},"Save"),e.createElement(g,{onClick:u},"Cancel")))))},ht=({handleLabelChange:i})=>{var E;const a=ce(),{labels:l,isLoading:r}=Se(),[d,c]=e.useState(""),[u,o]=s.useState(!1),[C,f]=s.useState(!1),[y,S]=s.useState(void 0);return e.createElement(e.Fragment,null,e.createElement(x,{onClick:t=>{t.key!="labels"?t.key=="inbox"?a("/text-threads"):t.key=="templates"?a("/text-templates"):a("/texts/"+t.key):o(!u)},mode:"horizontal"},e.createElement(x.Item,{key:"inbox",icon:e.createElement(Je,null)},e.createElement(D,{to:"/text-threads"},"Inbox")),e.createElement(x.Item,{key:"scheduled",icon:e.createElement(Ye,null)},e.createElement(D,{to:"/texts/scheduled"},"Scheduled")),e.createElement(x.Item,{key:"sent",icon:e.createElement(ct,null)},e.createElement(D,{to:"/texts/sent"},"Sent")),e.createElement(x.Item,{key:"failed",icon:e.createElement(xe,null)},e.createElement(D,{to:"/texts/failed"},"Failed")),e.createElement(x.Item,{key:"templates",icon:e.createElement(_e,null)},e.createElement(D,{to:"/text-templates"},"Templates")),e.createElement(x.Item,{key:"labels",icon:e.createElement(Ce,{style:{transform:"rotate(45deg)"}})},e.createElement(e.Fragment,null,e.createElement(Pe,{overlay:e.createElement(x,{onClick:t=>{t.key!="new"?i(t):f(!C)}},e.createElement(x.Item,{key:"search"},e.createElement(H,{placeholder:"Search",onKeyUp:t=>c(t.target.value),onClick:t=>t.stopPropagation()})),e.createElement(x.Item,{key:"disabled",disabled:!0},e.createElement(b.Text,{strong:!0},"SELECT TEXT LABEL")),e.createElement(x.Item,{key:""},e.createElement(te,null,"No label")),(E=l==null?void 0:l.filter(t=>t.name.includes(d)))==null?void 0:E.map(t=>e.createElement(x.Item,{key:t.name},e.createElement(te,null,t.name))),e.createElement(x.Divider,null),e.createElement(x.Item,{key:"new"},e.createElement("a",{onClick:t=>{t.preventDefault()}},"Create New Label"))),trigger:["click"],open:u},e.createElement(b.Text,null,"Labels"))))),e.createElement(yt,{isModalOpen:C,closeModal:()=>f(!1),textLabel:y}))},vt=({isModalOpen:i,closeModal:a,threadIds:l,defaultChecked:r,isViaMultiple:d})=>{const[c]=B.useForm(),{labels:u,isLoading:o}=Se(),[C,f]=s.useState("add"),y=Y(Qe,{onSuccess:()=>{T.invalidateQueries("textThreads"),E()}}),S=async t=>{console.log(t),await y.mutate({...t,threadIds:l,action:d?C:""})},E=()=>{a(),c.resetFields()};return s.useEffect(()=>{r&&c.setFieldValue("labels",r)},[r]),e.createElement(le,{className:"modal-activity",open:i,onCancel:a,footer:null,title:null,closable:!1,width:"300px"},e.createElement("div",{className:"modal-header"},e.createElement(b.Title,{level:5,style:{color:"white"}},"Assign Label"),e.createElement(g,{onClick:a,style:{backgroundColor:"rgba(0, 0, 0, 0.5)",border:"0px"},icon:e.createElement(ie,{style:{color:"white"}})})),e.createElement(h,{direction:"vertical",style:{padding:"20px",width:"100%",paddingTop:"30px"},size:0},e.createElement(B,{name:"basic",layout:"vertical",labelWrap:!0,onFinish:S,autoComplete:"off",form:c},d&&e.createElement("center",null,e.createElement(J.Group,{value:C,onChange:t=>f(t.target.value)},e.createElement(J.Button,{value:"add"},"Add"),e.createElement(J.Button,{value:"remove"},"Remove"))),e.createElement(B.Item,{name:"labels",labelCol:{span:24},wrapperCol:{span:24}},e.createElement(G.Group,{style:{display:"flex",flexDirection:"column",padding:"8px"}},u==null?void 0:u.map(t=>e.createElement(G,{key:t.id,value:t.id,style:{marginBottom:"8px"}},t.name)))),e.createElement(h,{style:{paddingTop:"5px"}},e.createElement(g,{type:"primary",htmlType:"submit",loading:y.isLoading},"Save"),e.createElement(g,{onClick:E},"Cancel")))))},xt=({label:i})=>{var ue,pe;const[a,l]=s.useState(!0);s.useState("");const[r,d]=s.useState({page_size:20,page:1,searchKey:"",label:"",total:0}),[c,u]=s.useState(localStorage.getItem("textStatus")??"Current");s.useEffect(()=>(c&&localStorage.setItem("textStatus",c),()=>{}),[c]);const{array:o,updateById:C,setInitialArray:f}=Ke(),{data:y,refetch:S}=gt({...r,textStatus:c},()=>{l(!1)}),E=n=>{d({...r,searchKey:n.target.value,page:1})},t=he.debounce(n=>{E(n)},500);ce();const[F,I]=s.useState(!1),[_,N]=s.useState(!1),[m,A]=s.useState(!1),[Q,O]=s.useState(!1),[z,p]=s.useState(!1),[v,k]=s.useState(void 0),[w,L]=s.useState([]),[me,de]=s.useState(!1),[K,j]=s.useState(!1),{data:P,isLoading:Ct,refetch:St}=ve("contact"),be=Y(qe,{onSuccess:()=>{T.invalidateQueries("textThreads"),I(!1),O(!1),k(void 0),L([])},onError:n=>{console.log(n.message||"An error occurred")}}),Te=Y(He,{onSuccess:()=>{T.invalidateQueries("textThreads"),N(!1),p(!1),k(void 0),L([])},onError:n=>{console.log(n.message||"An error occurred")}}),ke=(n,V)=>{d({...r,page:n,page_size:V})};return s.useEffect(()=>{d({...r,label:i})},[i]),s.useEffect(()=>{l(!0),S()},[r.page,r.searchKey,r.page_size,r.label,c]),s.useEffect(()=>{y&&y.data&&(f(y.data),d({...r,total:y.total}))},[y]),e.createElement(e.Fragment,null,e.createElement(H,{suffix:e.createElement(Ve,null),placeholder:"Search",style:{marginBottom:"20px"},onChange:t}),e.createElement(h,null,e.createElement(g,{onClick:n=>u("Current"),type:c=="Current"?"primary":"default"},"Current"),e.createElement(g,{onClick:n=>u("Archived"),type:c=="Archived"?"primary":"default"},"Archived")),w.length?e.createElement(h,{style:{width:"100%",marginTop:10,background:c=="Current"?"white":"#f8f8f8"}},e.createElement(g,{icon:e.createElement(ie,null),type:"text",onClick:()=>{L([])}}),e.createElement(b.Text,null,(w==null?void 0:w.length)+" Selected"),c=="Current"?e.createElement(g,{icon:e.createElement(xe,null),type:"text",onClick:()=>{j(!0),I(!0)}},"Archive"):e.createElement(g,{icon:e.createElement(et,null),type:"text",onClick:()=>{j(!0),N(!0)}},"Restore"),e.createElement(g,{onClick:()=>{j(!0),de(!0)},type:"text",icon:e.createElement(Ce,{style:{transform:"rotate(45deg)"}})},"Labels"),(P==null?void 0:P.find(n=>n.type=="tag"))&&e.createElement(g,{icon:e.createElement(Ue,null),type:"text",onClick:()=>{A(!0)}},"Tag")):e.createElement("div",{style:{height:"42px"}}),e.createElement("div",{style:{paddingLeft:10,paddingTop:5,background:c=="Current"?"white":"#f8f8f8"}},e.createElement(G,{onClick:n=>{n.target.checked?L(o.map(V=>V.id)):L([])}})),e.createElement(U,{itemLayout:"horizontal",style:{marginTop:0,height:"69vh",overflow:"auto",background:c=="Current"?"white":"#f8f8f8",paddingLeft:10,paddingRight:10}},a?e.createElement("div",{style:{display:"grid",placeItems:"center",marginTop:"50%"}},e.createElement(se,null)):e.createElement(e.Fragment,null,o!=null&&o.length||a?o==null?void 0:o.map((n,V)=>{var ge;return e.createElement(e.Fragment,null,V===0&&e.createElement(We,{style:{margin:"5px"}}),e.createElement(U.Item,{style:{cursor:"pointer",padding:"3px 0",backgroundColor:n.haveDuplicatePhoneNumbers?"#ffc166":""}},e.createElement(D,{onClick:()=>{C(n.id,{...n,isLastTextSeen:!0})},to:`/text-threads/${n.isContactSaved?`contact/${n.contactId}`:n.id}`,style:{padding:0,color:"black",width:"100%"}},e.createElement(q,{gutter:12,style:{width:"100%"}},e.createElement(M,{span:6},e.createElement(X,{style:{fontWeight:n!=null&&n.isLastTextSeen?"":"bold",fontSize:"16px"}},e.createElement(h,{onClick:$=>$.stopPropagation()},e.createElement(G,{checked:w.includes(n.id),onClick:$=>{const Ie=$.target.checked;L(Ie?Z=>[...Z,n.id]:Z=>Z.filter(we=>we!==n.id))}}),e.createElement("div",{style:{cursor:"default"}},"   ")),` ${n.contactName}`)),e.createElement(M,{span:15},e.createElement(X,{style:{fontWeight:n!=null&&n.isLastTextSeen?"":"bold"}},e.createElement(h,{size:0},(ge=n.labels)==null?void 0:ge.map($=>e.createElement(te,{style:{float:"right",fontWeight:"normal"}},$==null?void 0:$.name)),n==null?void 0:n.lastText))),e.createElement(M,{span:3},e.createElement(X,{style:{textAlign:"right"}},R.utc(n==null?void 0:n.created_at).local().isSame(R(),"day")?R.utc(n==null?void 0:n.created_at).local().format("hh:mm A"):R.utc(n==null?void 0:n.created_at).local().format("MMM DD")))))))}):e.createElement(ee,{style:{marginTop:"50%"}}))),e.createElement("center",null,e.createElement(Ge,{className:"p-t-sm",current:r.page,pageSize:r.page_size,total:r.total,onChange:ke,showSizeChanger:!1,size:"small"})),F&&e.createElement(Ee,{title:"Confirm",message:"Are you sure you want to archive this thread?",handleNo:()=>{I(!1),k(void 0)},handleYes:async()=>{O(!0),await be.mutate(K?{threadIds:w}:{threadIds:[v.id]}),k(void 0)},isOpen:F,loading:Q}),_&&e.createElement(Ee,{title:"Confirm",message:"Are you sure you want to restore this thread?",handleNo:()=>{N(!1),k(void 0)},handleYes:async()=>{p(!0),await Te.mutate(K?{threadIds:w}:{threadIds:[v.id]}),k(void 0)},isOpen:_,loading:z}),me&&e.createElement(vt,{isModalOpen:me,closeModal:()=>{de(!1),k(void 0),L([])},threadIds:K?w:[(v==null?void 0:v.id)??""],defaultChecked:K||(ue=v==null?void 0:v.labels)==null?void 0:ue.map(n=>n.id??""),isViaMultiple:K}),m&&e.createElement(Xe,{isModalOpen:m,closeModal:()=>A(!1),handleSubmit:()=>{T.invalidateQueries("textThreads"),A(!1),k(void 0),L([])},selectedRowKeys:w,type:"thread",defaultCustomFieldId:(pe=P==null?void 0:P.find(n=>n.type=="tag"))==null?void 0:pe.id}))},X=({children:i,style:a})=>{const r={...{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",alignItems:"center",justifyContent:"center"},...a};return e.createElement("div",{style:r},i)},Dt=()=>{s.useEffect(()=>(document.title="Texts - SpeedLead",()=>{}),[]);const[i,a]=s.useState(""),{threadId:l}=W(),{contactId:r}=W(),d=l||r;return e.createElement(h,{direction:"vertical",style:{width:"100%"}},e.createElement(ht,{handleLabelChange:c=>a(c.key)}),e.createElement(je,{bodyStyle:{padding:0}},e.createElement(q,{gutter:0,style:{height:"85vh"}},e.createElement(M,{span:d?11:24,style:{padding:"24px"}},e.createElement(xt,{label:i})),d&&e.createElement(M,{span:13,style:{backgroundColor:"#F5F5F5",margin:0,height:"85vh",overflowY:"auto"}},e.createElement(Et,{menu:"all"})))))};export{Dt as default};
========
import{r as s,B as ae,_ as ne,K as Y,L as T,ab as Le,J as e,a5 as R,T as fe,a9 as Me,M as h,N as g,I as B,bN as Fe,bO as he,aQ as ve,aa as Ne,aO as Ae,a8 as le,$ as b,Z as q,Y as M,V as H,b1 as U,S as se,a1 as ee,ag as Oe,O as re,P as oe,aC as ce,ai as W,bu as D,bP as ze,aR as $e,bQ as De,bR as Re,A as ie,U as Be,aZ as x,ad as Ye,bS as _e,a6 as Pe,bT as Qe,aW as Z,aY as G,aw as Ke,bU as Ve,aB as Ue,a4 as We,bV as Ge,bW as qe,bX as He,a2 as je}from"./app-5f014aea.js";import{C as Xe}from"./ContactInfo-9c504ce0.js";import{T as te}from"./index-0d11b452.js";import{I as Ze}from"./InboxOutlined-2bab4218.js";import{D as xe}from"./DeleteOutlined-4dec168e.js";import{C as Ee}from"./ConfirmModal-8aca5345.js";import{C as Je}from"./ContactBulkUpdate-22ccf5d8.js";import{R as et}from"./RedoOutlined-29a12b70.js";import"./DropdownComponent-dccabc3b.js";import"./useContactMutation-6d5d89e5.js";import"./ContactInfoEditableText-7222f84a.js";import"./TextEllipsis-f00932cd.js";import"./index-9e94c549.js";var tt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"};const at=tt;var nt=function(a,l){return s.createElement(ae,ne({},a,{ref:l,icon:at}))};const lt=s.forwardRef(nt);var st={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"};const rt=st;var ot=function(a,l){return s.createElement(ae,ne({},a,{ref:l,icon:rt}))};const ct=s.forwardRef(ot);var it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM699 387c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"}}]},name:"tag",theme:"filled"};const mt=it;var dt=function(a,l){return s.createElement(ae,ne({},a,{ref:l,icon:mt}))};const Ce=s.forwardRef(dt),ut=({name:i,text:a})=>{const l=Y(Le,{onSuccess:r=>{T.invalidateQueries("thread")}});return a.isFromApp?e.createElement("div",{style:{padding:"10px",display:"flex",alignItems:"center",flexDirection:"row-reverse"}},e.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"}},e.createElement("div",{style:{display:"flex",alignItems:"center",backgroundColor:"#D6EAFF",padding:"12px 24px",borderRadius:"20px 20px 0 20px"}},a.status=="failed"?e.createElement(fe,{title:a==null?void 0:a.errorMessage},e.createElement(lt,{style:{color:"red"}})):null,a.status=="scheduled"&&a.schedule?e.createElement(fe,{title:`Will be sent on ${R.utc(a.schedule).local().format("MMM DD, YYYY hh:mm A")}`},e.createElement(Me,null)):null,e.createElement("div",{className:"p-l-xs"},a.message)),e.createElement(h,{style:{marginTop:"8px",fontSize:"10px"},size:1},`${R.utc(a.created_at).local().format("MMM DD, YYYY hh:mm A")} ${a.to.replace(/^(\d{3})(\d{3})(\d{4})$/,"($1) $2-$3")}`,a.status=="failed"&&e.createElement(g,{className:"p-0",type:"text",style:{color:"red",cursor:"pointer",fontSize:"10px"},onClick:()=>{l.mutate({data:{id:a.id},url:"/api/texts/resend"})},loading:l.isLoading},"Re-try"),a.status=="queued"&&e.createElement("div",null,"(Sending)")))):e.createElement("div",{style:{padding:"10px",display:"flex",alignItems:"center"}},e.createElement("div",{style:{display:"flex",flexDirection:"column"}},e.createElement("div",{style:{backgroundColor:"white",padding:"12px 24px",borderRadius:"20px 20px 20px 0"}},a.message),e.createElement("div",{style:{marginTop:"8px",fontSize:"10px"}},`${a.from.replace(/^(\d{3})(\d{3})(\d{4})$/,"($1) $2-$3")} ${R.utc(a.created_at).local().format("MMM DD, YYYY hh:mm A")}`)))},pt=({isModalOpen:i,closeModal:a,handleSubmit:l,contactNumber:r})=>{const[d]=B.useForm(),[c,u]=s.useState(1),[o,C]=s.useState(void 0),[f,y]=s.useState(),[S,E]=s.useState(""),[t,F]=s.useState(!1),{data:I,refetch:_}=Fe({keyword:S},"/api/contacts/global-search","globalSearch",()=>{F(!1)}),N=he.debounce(()=>{_()},500);s.useEffect(()=>{I&&I.data&&y(I.data.data)},[I]);const{data:m,isLoading:A,refetch:Q}=ve("contact"),O=Y(Ae,{onSuccess:()=>{z(),l&&l()},onError:p=>{Ne.error(p.message||"An error occurred")}}),z=()=>{a(),d.resetFields()};return console.log({contactFields:m}),e.createElement(le,{title:e.createElement(b.Text,null,"Select Contact"),open:i,onCancel:z,className:"manage-column-field",footer:!1},c===1?e.createElement(e.Fragment,null,e.createElement(q,{gutter:12},e.createElement(M,{span:24},e.createElement(H,{placeholder:"Search Contact",className:"w-100",onChange:p=>{F(!0),E(p.target.value),N()}})),e.createElement(M,{span:24,className:"m-t-md"},e.createElement(U,{className:"field-list",size:"default",header:!1,footer:!1,bordered:!0},e.createElement(e.Fragment,null,t&&e.createElement("div",{style:{display:"grid",placeItems:"center",padding:"24px"}},e.createElement(se,null)),!t&&e.createElement(e.Fragment,null,f!=null&&f.length?f==null?void 0:f.map(p=>e.createElement("div",{className:"w-100",onClick:()=>{u(2),C(p)}},e.createElement(ye,{text:`${p.fields.firstName} ${p.fields.lastName}`}))):e.createElement(ee,{image:ee.PRESENTED_IMAGE_SIMPLE}))))))):e.createElement(e.Fragment,null,e.createElement(h,{className:"m-b-sm"},e.createElement(b.Text,{strong:!0},`Phone type fields of ${o==null?void 0:o.fields.firstName} ${o==null?void 0:o.fields.lastName}`),e.createElement(g,{type:"link",className:"p-l-none",onClick:()=>u(1)},"Change")),e.createElement(U,{className:"field-list",size:"large",header:!1,footer:!1,bordered:!0,dataSource:m==null?void 0:m.filter(p=>["phone","mobile"].includes(p.type)),renderItem:p=>e.createElement(Oe,{title:"Update Contact",description:`Are you sure you want to replace this field with ${r}?`,onConfirm:async()=>{await O.mutate({customableId:o==null?void 0:o.id,customableType:"contact",fields:{[p.fieldName]:r}})}},e.createElement("div",{className:"w-100"},e.createElement(ye,{text:p.label,subText:(o==null?void 0:o.fields[p.fieldName])??"Not set"})))})))},ye=({text:i,subText:a})=>e.createElement(e.Fragment,null,e.createElement(U.Item,{style:{cursor:"pointer"}},e.createElement(h,{direction:"vertical",size:0},e.createElement(b.Text,{strong:!0},i),e.createElement(b.Text,null,a??"")))),Se=()=>{const{data:i,isLoading:a}=re("textLabels",async()=>{const l=localStorage.getItem("access_token");return(await oe.get("/api/text-labels",{headers:{Authorization:`Bearer ${l}`}})).data},{staleTime:1/0});return{labels:i,isLoading:a}},gt=(i,a)=>{const{data:l,isLoading:r,refetch:d}=re("textThreads",async()=>{const c=localStorage.getItem("access_token");return(await oe.get("/api/text-threads",{headers:{Authorization:`Bearer ${c}`},params:i})).data},{staleTime:1/0,onSuccess:()=>{a&&a()}});return{data:l,isLoading:r,refetch:d}},ft=(i,a,l)=>{const{data:r,isLoading:d,isError:c,refetch:u}=re("thread",async()=>{try{const o=localStorage.getItem("access_token");return(await oe.get(`/api/text-threads/${i}?type=${a}`,{headers:{Authorization:`Bearer ${o}`}})).data}catch(o){throw new Error(`Error fetching text thread: ${o.message}`)}},{staleTime:1/0,onSuccess:o=>{l&&l(o)}});return{thread:r,isLoading:d,isError:c,refetch:u}},Et=({menu:i})=>{var A,Q,O,z,p;const a=ce(),[l,r]=s.useState(!1),[d,c]=e.useState(0),u=e.useRef(null),[o,C]=s.useState(!1),[f,y]=s.useState(!1),{threadId:S}=W(),{contactId:E}=W(),{thread:t,refetch:F,isLoading:I}=ft(E??S??"",E?"contact":"thread",v=>{r(!1)}),_=Y(De,{onSuccess:()=>{}});s.useEffect(()=>{!S&&!E?a("/text-threads"):(r(!0),F())},[S,E]),e.useEffect(()=>{t&&(_.mutate({id:E??S,type:E?"contact":"thread"}),document.title=t.contactName+" - SpeedLead")},[t]);const N=()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},m=t==null?void 0:t.texts[(t==null?void 0:t.texts.length)-1];return e.useEffect(()=>(N(),c(d+1),console.log("thread",t),()=>{}),[t]),["all","inbox","scheduled"].includes(i)?e.createElement(e.Fragment,null,l?e.createElement("div",{style:{display:"grid",placeItems:"center",marginTop:"50%"}},e.createElement(se,null)):e.createElement(q,{key:S},e.createElement(M,{span:13,style:{height:"85vh",overflowY:"auto"},ref:u},e.createElement("div",{style:{backgroundColor:"white",width:"100%",padding:"15px",display:"flex",alignItems:"center",position:"sticky",top:0,zIndex:1}},e.createElement(h,{direction:"vertical",size:0},(A=t==null?void 0:t.contact)!=null&&A.id?e.createElement(D,{to:"/contacts/"+((Q=t==null?void 0:t.contact)==null?void 0:Q.id)+"/"+t.contact.fields.firstName.replace(/\s/g,"-")+"-"+t.contact.fields.lastName.replace(/\s/g,"-")},e.createElement(b.Text,{strong:!0},t==null?void 0:t.contactName)):e.createElement(b.Text,{strong:!0},t==null?void 0:t.contactName),e.createElement(b.Text,null,t==null?void 0:t.phoneNumbers))),e.createElement("div",{style:{paddingTop:"150px",height:"85%"}},e.createElement("div",{style:{minHeight:"80%"}},(O=t==null?void 0:t.texts)==null?void 0:O.sort((v,k)=>parseInt(v.id??"0")-parseInt(k.id??"0")).map(v=>e.createElement(ut,{name:t==null?void 0:t.contactName,text:v,key:v.id}))),e.createElement("div",{style:{position:"sticky",bottom:0,left:0,width:"100%",backgroundColor:"white",padding:"10px"},key:d},e.createElement(ze,{handleSubmit:()=>{T.invalidateQueries("thread")},phoneNumbers:t!=null&&t.contact?(z=t==null?void 0:t.contact)==null?void 0:z.phoneNumbers:[t==null?void 0:t.phoneNumbers],defaultTo:m!=null&&m.isFromApp?m==null?void 0:m.to:m==null?void 0:m.from,defaultFrom:((p=t==null?void 0:t.contact)==null?void 0:p.defaultMobileNumber)??(m!=null&&m.isFromApp?m==null?void 0:m.from:m==null?void 0:m.to),contact:(t==null?void 0:t.contact)??void 0})))),e.createElement(M,{span:11,style:{height:"85vh",overflowY:"auto"}},e.createElement(h,{direction:"vertical",size:0,style:{width:"100%",overflowY:"auto"}},e.createElement("div",{style:{backgroundColor:"#F5F5F5",width:"100%",padding:"15px",display:"flex",fontWeight:"bold",height:"74px",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:"16px"}},"Related Information"),t!=null&&t.contact?e.createElement(Xe,{contact:t==null?void 0:t.contact}):e.createElement(h,{style:{textAlign:"center"},className:"w-100",size:"large",direction:"vertical"},"Number not saved in contacts",e.createElement(g,{onClick:()=>C(!0)},"Create Contact"),e.createElement(g,{onClick:()=>y(!0)},"Add to existing Contact")))),o&&e.createElement($e,{isModalOpen:o,closeModal:()=>{C(!1)},handleSubmit:()=>{T.invalidateQueries("textThreads"),T.invalidateQueries("thread")},type:"contact",record:{mobile:t==null?void 0:t.phoneNumbers}}),f&&e.createElement(pt,{isModalOpen:f,closeModal:()=>y(!1),handleSubmit:()=>{T.invalidateQueries("textThreads"),T.invalidateQueries("thread")},contactNumber:t==null?void 0:t.phoneNumbers}))):null},yt=({isModalOpen:i,closeModal:a,textLabel:l})=>{const[r]=B.useForm(),d=Y(Re,{onSuccess:()=>{T.invalidateQueries("textLabels"),a(),u()},onError:o=>{console.log(o.message||"An error occurred")}}),c=async o=>{await d.mutate({...o,id:l!=null&&l.id?l.id:""})},u=()=>{a(),r.resetFields()};return s.useEffect(()=>{l!=null&&l.name?r.setFieldValue("name",l.name):r.resetFields()},[l]),e.createElement(le,{className:"modal-activity",open:i,onCancel:a,footer:null,title:null,closable:!1},e.createElement("div",{className:"modal-header"},e.createElement(b.Title,{level:5,style:{color:"white"}},l?"Update":"Create new"," label"),e.createElement(g,{onClick:a,style:{backgroundColor:"rgba(0, 0, 0, 0.5)",border:"0px"},icon:e.createElement(ie,{style:{color:"white"}})})),e.createElement(h,{direction:"vertical",style:{padding:"20px",width:"100%",paddingTop:"30px"},size:0},e.createElement(B,{name:"basic",layout:"vertical",labelWrap:!0,onFinish:c,autoComplete:"off",form:r},e.createElement(B.Item,{name:"name",label:"Label name",rules:[{required:!0,message:Be}]},e.createElement(H,{placeholder:"Folder name"})),e.createElement(h,{style:{paddingTop:"5px"}},e.createElement(g,{type:"primary",htmlType:"submit",loading:d.isLoading},"Save"),e.createElement(g,{onClick:u},"Cancel")))))},ht=({handleLabelChange:i})=>{var E;const a=ce(),{labels:l,isLoading:r}=Se(),[d,c]=e.useState(""),[u,o]=s.useState(!1),[C,f]=s.useState(!1),[y,S]=s.useState(void 0);return e.createElement(e.Fragment,null,e.createElement(x,{onClick:t=>{t.key!="labels"?t.key=="inbox"?a("/text-threads"):t.key=="templates"?a("/text-templates"):a("/texts/"+t.key):o(!u)},mode:"horizontal"},e.createElement(x.Item,{key:"inbox",icon:e.createElement(Ze,null)},e.createElement(D,{to:"/text-threads"},"Inbox")),e.createElement(x.Item,{key:"scheduled",icon:e.createElement(Ye,null)},e.createElement(D,{to:"/texts/scheduled"},"Scheduled")),e.createElement(x.Item,{key:"sent",icon:e.createElement(ct,null)},e.createElement(D,{to:"/texts/sent"},"Sent")),e.createElement(x.Item,{key:"failed",icon:e.createElement(xe,null)},e.createElement(D,{to:"/texts/failed"},"Failed")),e.createElement(x.Item,{key:"templates",icon:e.createElement(_e,null)},e.createElement(D,{to:"/text-templates"},"Templates")),e.createElement(x.Item,{key:"labels",icon:e.createElement(Ce,{style:{transform:"rotate(45deg)"}})},e.createElement(e.Fragment,null,e.createElement(Pe,{overlay:e.createElement(x,{onClick:t=>{t.key!="new"?i(t):f(!C)}},e.createElement(x.Item,{key:"search"},e.createElement(H,{placeholder:"Search",onKeyUp:t=>c(t.target.value),onClick:t=>t.stopPropagation()})),e.createElement(x.Item,{key:"disabled",disabled:!0},e.createElement(b.Text,{strong:!0},"SELECT TEXT LABEL")),e.createElement(x.Item,{key:""},e.createElement(te,null,"No label")),(E=l==null?void 0:l.filter(t=>t.name.includes(d)))==null?void 0:E.map(t=>e.createElement(x.Item,{key:t.name},e.createElement(te,null,t.name))),e.createElement(x.Divider,null),e.createElement(x.Item,{key:"new"},e.createElement("a",{onClick:t=>{t.preventDefault()}},"Create New Label"))),trigger:["click"],open:u},e.createElement(b.Text,null,"Labels"))))),e.createElement(yt,{isModalOpen:C,closeModal:()=>f(!1),textLabel:y}))},vt=({isModalOpen:i,closeModal:a,threadIds:l,defaultChecked:r,isViaMultiple:d})=>{const[c]=B.useForm(),{labels:u,isLoading:o}=Se(),[C,f]=s.useState("add"),y=Y(Qe,{onSuccess:()=>{T.invalidateQueries("textThreads"),E()}}),S=async t=>{console.log(t),await y.mutate({...t,threadIds:l,action:d?C:""})},E=()=>{a(),c.resetFields()};return s.useEffect(()=>{r&&c.setFieldValue("labels",r)},[r]),e.createElement(le,{className:"modal-activity",open:i,onCancel:a,footer:null,title:null,closable:!1,width:"300px"},e.createElement("div",{className:"modal-header"},e.createElement(b.Title,{level:5,style:{color:"white"}},"Assign Label"),e.createElement(g,{onClick:a,style:{backgroundColor:"rgba(0, 0, 0, 0.5)",border:"0px"},icon:e.createElement(ie,{style:{color:"white"}})})),e.createElement(h,{direction:"vertical",style:{padding:"20px",width:"100%",paddingTop:"30px"},size:0},e.createElement(B,{name:"basic",layout:"vertical",labelWrap:!0,onFinish:S,autoComplete:"off",form:c},d&&e.createElement("center",null,e.createElement(Z.Group,{value:C,onChange:t=>f(t.target.value)},e.createElement(Z.Button,{value:"add"},"Add"),e.createElement(Z.Button,{value:"remove"},"Remove"))),e.createElement(B.Item,{name:"labels",labelCol:{span:24},wrapperCol:{span:24}},e.createElement(G.Group,{style:{display:"flex",flexDirection:"column",padding:"8px"}},u==null?void 0:u.map(t=>e.createElement(G,{key:t.id,value:t.id,style:{marginBottom:"8px"}},t.name)))),e.createElement(h,{style:{paddingTop:"5px"}},e.createElement(g,{type:"primary",htmlType:"submit",loading:y.isLoading},"Save"),e.createElement(g,{onClick:E},"Cancel")))))},xt=({label:i})=>{var ue,pe;const[a,l]=s.useState(!0);s.useState("");const[r,d]=s.useState({page_size:20,page:1,searchKey:"",label:"",total:0}),[c,u]=s.useState(localStorage.getItem("textStatus")??"Current");s.useEffect(()=>(c&&localStorage.setItem("textStatus",c),()=>{}),[c]);const{array:o,updateById:C,setInitialArray:f}=Ke(),{data:y,refetch:S}=gt({...r,textStatus:c},()=>{l(!1)}),E=n=>{d({...r,searchKey:n.target.value,page:1})},t=he.debounce(n=>{E(n)},500);ce();const[F,I]=s.useState(!1),[_,N]=s.useState(!1),[m,A]=s.useState(!1),[Q,O]=s.useState(!1),[z,p]=s.useState(!1),[v,k]=s.useState(void 0),[w,L]=s.useState([]),[me,de]=s.useState(!1),[K,j]=s.useState(!1),{data:P,isLoading:Ct,refetch:St}=ve("contact"),be=Y(qe,{onSuccess:()=>{T.invalidateQueries("textThreads"),I(!1),O(!1),k(void 0),L([])},onError:n=>{console.log(n.message||"An error occurred")}}),Te=Y(He,{onSuccess:()=>{T.invalidateQueries("textThreads"),N(!1),p(!1),k(void 0),L([])},onError:n=>{console.log(n.message||"An error occurred")}}),ke=(n,V)=>{d({...r,page:n,page_size:V})};return s.useEffect(()=>{d({...r,label:i})},[i]),s.useEffect(()=>{l(!0),S()},[r.page,r.searchKey,r.page_size,r.label,c]),s.useEffect(()=>{y&&y.data&&(f(y.data),d({...r,total:y.total}))},[y]),e.createElement(e.Fragment,null,e.createElement(H,{suffix:e.createElement(Ve,null),placeholder:"Search",style:{marginBottom:"20px"},onChange:t}),e.createElement(h,null,e.createElement(g,{onClick:n=>u("Current"),type:c=="Current"?"primary":"default"},"Current"),e.createElement(g,{onClick:n=>u("Archived"),type:c=="Archived"?"primary":"default"},"Archived")),w.length?e.createElement(h,{style:{width:"100%",marginTop:10,background:c=="Current"?"white":"#f8f8f8"}},e.createElement(g,{icon:e.createElement(ie,null),type:"text",onClick:()=>{L([])}}),e.createElement(b.Text,null,(w==null?void 0:w.length)+" Selected"),c=="Current"?e.createElement(g,{icon:e.createElement(xe,null),type:"text",onClick:()=>{j(!0),I(!0)}},"Archive"):e.createElement(g,{icon:e.createElement(et,null),type:"text",onClick:()=>{j(!0),N(!0)}},"Restore"),e.createElement(g,{onClick:()=>{j(!0),de(!0)},type:"text",icon:e.createElement(Ce,{style:{transform:"rotate(45deg)"}})},"Labels"),(P==null?void 0:P.find(n=>n.type=="tag"))&&e.createElement(g,{icon:e.createElement(Ue,null),type:"text",onClick:()=>{A(!0)}},"Tag")):e.createElement("div",{style:{height:"42px"}}),e.createElement("div",{style:{paddingLeft:10,paddingTop:5,background:c=="Current"?"white":"#f8f8f8"}},e.createElement(G,{onClick:n=>{n.target.checked?L(o.map(V=>V.id)):L([])}})),e.createElement(U,{itemLayout:"horizontal",style:{marginTop:0,height:"69vh",overflow:"auto",background:c=="Current"?"white":"#f8f8f8",paddingLeft:10,paddingRight:10}},a?e.createElement("div",{style:{display:"grid",placeItems:"center",marginTop:"50%"}},e.createElement(se,null)):e.createElement(e.Fragment,null,o!=null&&o.length||a?o==null?void 0:o.map((n,V)=>{var ge;return e.createElement(e.Fragment,null,V===0&&e.createElement(We,{style:{margin:"5px"}}),e.createElement(U.Item,{style:{cursor:"pointer",padding:"3px 0",backgroundColor:n.haveDuplicatePhoneNumbers?"#ffc166":""}},e.createElement(D,{onClick:()=>{C(n.id,{...n,isLastTextSeen:!0})},to:`/text-threads/${n.isContactSaved?`contact/${n.contactId}`:n.id}`,style:{padding:0,color:"black",width:"100%"}},e.createElement(q,{gutter:12,style:{width:"100%"}},e.createElement(M,{span:6},e.createElement(J,{style:{fontWeight:n!=null&&n.isLastTextSeen?"":"bold",fontSize:"16px"}},e.createElement(h,{onClick:$=>$.stopPropagation()},e.createElement(G,{checked:w.includes(n.id),onClick:$=>{const Ie=$.target.checked;L(Ie?X=>[...X,n.id]:X=>X.filter(we=>we!==n.id))}}),e.createElement("div",{style:{cursor:"default"}},"   ")),` ${n.contactName}`)),e.createElement(M,{span:15},e.createElement(J,{style:{fontWeight:n!=null&&n.isLastTextSeen?"":"bold"}},e.createElement(h,{size:0},(ge=n.labels)==null?void 0:ge.map($=>e.createElement(te,{style:{float:"right",fontWeight:"normal"}},$==null?void 0:$.name)),n==null?void 0:n.lastText))),e.createElement(M,{span:3},e.createElement(J,{style:{textAlign:"right"}},R.utc(n==null?void 0:n.created_at).local().isSame(R(),"day")?R.utc(n==null?void 0:n.created_at).local().format("hh:mm A"):R.utc(n==null?void 0:n.created_at).local().format("MMM DD")))))))}):e.createElement(ee,{style:{marginTop:"50%"}}))),e.createElement("center",null,e.createElement(Ge,{className:"p-t-sm",current:r.page,pageSize:r.page_size,total:r.total,onChange:ke,showSizeChanger:!1,size:"small"})),F&&e.createElement(Ee,{title:"Confirm",message:"Are you sure you want to archive this thread?",handleNo:()=>{I(!1),k(void 0)},handleYes:async()=>{O(!0),await be.mutate(K?{threadIds:w}:{threadIds:[v.id]}),k(void 0)},isOpen:F,loading:Q}),_&&e.createElement(Ee,{title:"Confirm",message:"Are you sure you want to restore this thread?",handleNo:()=>{N(!1),k(void 0)},handleYes:async()=>{p(!0),await Te.mutate(K?{threadIds:w}:{threadIds:[v.id]}),k(void 0)},isOpen:_,loading:z}),me&&e.createElement(vt,{isModalOpen:me,closeModal:()=>{de(!1),k(void 0),L([])},threadIds:K?w:[(v==null?void 0:v.id)??""],defaultChecked:K||(ue=v==null?void 0:v.labels)==null?void 0:ue.map(n=>n.id??""),isViaMultiple:K}),m&&e.createElement(Je,{isModalOpen:m,closeModal:()=>A(!1),handleSubmit:()=>{T.invalidateQueries("textThreads"),A(!1),k(void 0),L([])},selectedRowKeys:w,type:"thread",defaultCustomFieldId:(pe=P==null?void 0:P.find(n=>n.type=="tag"))==null?void 0:pe.id}))},J=({children:i,style:a})=>{const r={...{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",alignItems:"center",justifyContent:"center"},...a};return e.createElement("div",{style:r},i)},Dt=()=>{s.useEffect(()=>(document.title="Texts - SpeedLead",()=>{}),[]);const[i,a]=s.useState(""),{threadId:l}=W(),{contactId:r}=W(),d=l||r;return e.createElement(h,{direction:"vertical",style:{width:"100%"}},e.createElement(ht,{handleLabelChange:c=>a(c.key)}),e.createElement(je,{bodyStyle:{padding:0}},e.createElement(q,{gutter:0,style:{height:"85vh"}},e.createElement(M,{span:d?11:24,style:{padding:"24px"}},e.createElement(xt,{label:i})),d&&e.createElement(M,{span:13,style:{backgroundColor:"#F5F5F5",margin:0,height:"85vh",overflowY:"auto"}},e.createElement(Et,{menu:"all"})))))};export{Dt as default};
>>>>>>>> 7-15-24-Goran-kanban_board_pagination:public/build/assets/TextBoxView-95700557.js
