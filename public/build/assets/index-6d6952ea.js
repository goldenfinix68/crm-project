import{I as P,K as S,L as f,ci as A,r as D,J as e,a8 as F,$ as b,N as E,A as I,M as d,U as k,V as x,cj as L,af as M,ck as T,b0 as C,be as w,az as h,ae as O,cl as U,cm as N,bv as _,ak as Q,a2 as q}from"./app-017b6879.js";import{l as g}from"./index-3b028834.js";import{u as z,a as R}from"./useDrop-fec13fc8.js";import{D as v}from"./DeleteOutlined-8a3cfa98.js";import"./objectWithoutProperties-613aba8b.js";import"./Steps-8e373c50.js";import"./Upload-8d5b31c4.js";const V=({isModalOpen:t,closeModal:l,handleSubmit:o,stage:n,pipelineId:m})=>{const[s]=P.useForm(),r=S(A,{onSuccess:()=>{f.invalidateQueries("dealPipelines"),l(),c()},onError:a=>{console.log(a.message||"An error occurred")}}),u=async a=>{await r.mutate({...a,id:n!=null&&n.id?n.id:"",dealPipelineId:m})},c=()=>{l(),s.resetFields(),s.setFieldsValue({columnLayout:"one"})};return D.useEffect(()=>{n?s.setFieldsValue(n):s.resetFields()},[n]),e.createElement(F,{className:"modal-activity",open:t,onCancel:l,footer:null,title:null,closable:!1},e.createElement("div",{className:"modal-header"},e.createElement(b.Title,{level:5,style:{color:"white"}},n?"Update":"Create New"," Pipeline Stage"),e.createElement(E,{onClick:l,style:{backgroundColor:"rgba(0, 0, 0, 0.5)",border:"0px"},icon:e.createElement(I,{style:{color:"white"}})})),e.createElement(d,{direction:"vertical",style:{padding:"20px",width:"100%",paddingTop:"30px"},size:0},e.createElement(P,{name:"basic",layout:"vertical",labelWrap:!0,onFinish:u,autoComplete:"off",form:s,initialValues:{columnLayout:"one"}},e.createElement(P.Item,{name:"name",label:"Stage Name",rules:[{required:!0,message:k}]},e.createElement(x,null)),e.createElement(d,{style:{paddingTop:"5px"}},e.createElement(E,{type:"primary",htmlType:"submit",loading:r.isLoading},"Save"),e.createElement(E,{onClick:c},"Cancel")))))},G=({index:t,stage:l,stages:o,handleEditClick:n})=>{const m=S(a=>L(a),{onSuccess:()=>{f.invalidateQueries("dealPipelines")},onError:a=>{console.log(a.message||"An error occurred")}}),[,s]=z({type:"CUSTOM_FIELD",item:{index:t}}),[,r]=R({accept:"CUSTOM_FIELD",drop:a=>{a.index!==t&&(c(a.index,t),a.index=t)}}),u=S(T,{onSuccess:()=>{f.invalidateQueries("dealPipelines"),M.success("Succesfully saved.")},onError:a=>{console.log(a.message||"An error occurred")}}),c=(a,i)=>{const p=[...o||[]],[y]=p.splice(a,1);p.splice(i,0,y),u.mutate(p)};return e.createElement(e.Fragment,null,e.createElement(C.Item,{key:l.id,style:{cursor:"move",width:"100%"},ref:a=>s(r(a))},e.createElement(C.Item.Meta,{title:e.createElement(d,null,e.createElement(w,{className:"p-t-xs"}),l.name)}),e.createElement(d,null,e.createElement(h,{style:{cursor:"pointer"},onClick:()=>{n(l)}}),e.createElement(O,{title:"Delete",description:"Are you sure to delete this stage?",onConfirm:async()=>await m.mutate(l.id),okText:"Yes",cancelText:"No"},e.createElement(v,null)))))},Y=({pipeline:t})=>{const[l,o]=e.useState(!1),[n,m]=e.useState(),[s,r]=e.useState(!1),[u,c]=e.useState(),a=S(i=>N(i),{onSuccess:()=>{f.invalidateQueries("dealPipelines")},onError:i=>{console.log(i.message||"An error occurred")}});return e.createElement(e.Fragment,null,e.createElement(g.Card,{title:t.name,key:t.id,extra:e.createElement(d,null,e.createElement(E,{type:"default",size:"small",onClick:()=>r(!0)},"Add New Stage"),e.createElement(h,{style:{cursor:"pointer"},onClick:()=>{m(t),o(!0)}}),e.createElement(g.Popconfirm,{title:"Delete",description:"Are you sure to delete this pipeline?",onConfirm:async()=>await a.mutate(t.id),okText:"Yes",cancelText:"No"},e.createElement(v,null)))},e.createElement(C,{size:"small",header:!1,footer:!1,dataSource:t==null?void 0:t.stages,renderItem:(i,p)=>e.createElement(G,{index:p,stage:i,stages:(t==null?void 0:t.stages)??[],handleEditClick:y=>{r(!0),c(y)}})})),e.createElement(U,{isModalOpen:l,closeModal:()=>o(!1),handleSubmit:()=>{console.log("qwe")},pipeline:n}),e.createElement(V,{isModalOpen:s,closeModal:()=>r(!1),handleSubmit:()=>{console.log("qwe")},pipelineId:t.id,stage:u}))},X=()=>{const{data:t,isLoading:l}=_();return D.useEffect(()=>(document.title="Deal Pipeline Setup - SpeedLead",()=>{}),[]),l?e.createElement(Q,null):e.createElement(e.Fragment,null,t!=null&&t.length?e.createElement(d,{direction:"vertical",style:{width:"100%"}},t==null?void 0:t.map((o,n)=>e.createElement(Y,{pipeline:o}))):e.createElement(q,null,e.createElement(g.Empty,{image:g.Empty.PRESENTED_IMAGE_SIMPLE})))};export{X as default};
