import{I as P,K as S,L as g,ck as F,r as A,J as e,a8 as b,$ as v,N as E,A as I,M as d,U as w,V as x,cl as L,aa as M,cm as T,b1 as C,bf as k,aA as D,ag as O,cn as U,co as N,bw as _,al as Q,a2 as q}from"./app-0ecc6883.js";import{l as f}from"./index-b8228bd1.js";import{u as R,a as V}from"./useDrop-2948ba66.js";import{D as h}from"./DeleteOutlined-4869fee5.js";import"./defineProperty-96b5e53a.js";import"./Paragraph-b1edbf65.js";import"./Upload-b32435b3.js";import"./objectWithoutProperties-89b13c98.js";const z=({isModalOpen:t,closeModal:l,handleSubmit:o,stage:n,pipelineId:m})=>{const[s]=P.useForm(),r=S(F,{onSuccess:()=>{g.invalidateQueries("dealPipelines"),l(),c()},onError:a=>{console.log(a.message||"An error occurred")}}),u=async a=>{await r.mutate({...a,id:n!=null&&n.id?n.id:"",dealPipelineId:m})},c=()=>{l(),s.resetFields(),s.setFieldsValue({columnLayout:"one"})};return A.useEffect(()=>{n?s.setFieldsValue(n):s.resetFields()},[n]),e.createElement(b,{className:"modal-activity",open:t,onCancel:l,footer:null,title:null,closable:!1},e.createElement("div",{className:"modal-header"},e.createElement(v.Title,{level:5,style:{color:"white"}},n?"Update":"Create New"," Pipeline Stage"),e.createElement(E,{onClick:l,style:{backgroundColor:"rgba(0, 0, 0, 0.5)",border:"0px"},icon:e.createElement(I,{style:{color:"white"}})})),e.createElement(d,{direction:"vertical",style:{padding:"20px",width:"100%",paddingTop:"30px"},size:0},e.createElement(P,{name:"basic",layout:"vertical",labelWrap:!0,onFinish:u,autoComplete:"off",form:s,initialValues:{columnLayout:"one"}},e.createElement(P.Item,{name:"name",label:"Stage Name",rules:[{required:!0,message:w}]},e.createElement(x,null)),e.createElement(d,{style:{paddingTop:"5px"}},e.createElement(E,{type:"primary",htmlType:"submit",loading:r.isLoading},"Save"),e.createElement(E,{onClick:c},"Cancel")))))},G=({index:t,stage:l,stages:o,handleEditClick:n})=>{const m=S(a=>L(a),{onSuccess:()=>{g.invalidateQueries("dealPipelines")},onError:a=>{console.log(a.message||"An error occurred")}}),[,s]=R({type:"CUSTOM_FIELD",item:{index:t}}),[,r]=V({accept:"CUSTOM_FIELD",drop:a=>{a.index!==t&&(c(a.index,t),a.index=t)}}),u=S(T,{onSuccess:()=>{g.invalidateQueries("dealPipelines"),M.success("Succesfully saved.")},onError:a=>{console.log(a.message||"An error occurred")}}),c=(a,i)=>{const p=[...o||[]],[y]=p.splice(a,1);p.splice(i,0,y),u.mutate(p)};return e.createElement(e.Fragment,null,e.createElement(C.Item,{key:l.id,style:{cursor:"move",width:"100%"},ref:a=>s(r(a))},e.createElement(C.Item.Meta,{title:e.createElement(d,null,e.createElement(k,{className:"p-t-xs"}),l.name)}),e.createElement(d,null,e.createElement(D,{style:{cursor:"pointer"},onClick:()=>{n(l)}}),e.createElement(O,{title:"Delete",description:"Are you sure to delete this stage?",onConfirm:async()=>await m.mutate(l.id),okText:"Yes",cancelText:"No"},e.createElement(h,null)))))},Y=({pipeline:t})=>{const[l,o]=e.useState(!1),[n,m]=e.useState(),[s,r]=e.useState(!1),[u,c]=e.useState(),a=S(i=>N(i),{onSuccess:()=>{g.invalidateQueries("dealPipelines")},onError:i=>{console.log(i.message||"An error occurred")}});return e.createElement(e.Fragment,null,e.createElement(f.Card,{title:t.name,key:t.id,extra:e.createElement(d,null,e.createElement(E,{type:"default",size:"small",onClick:()=>r(!0)},"Add New Stage"),e.createElement(D,{style:{cursor:"pointer"},onClick:()=>{m(t),o(!0)}}),e.createElement(f.Popconfirm,{title:"Delete",description:"Are you sure to delete this pipeline?",onConfirm:async()=>await a.mutate(t.id),okText:"Yes",cancelText:"No"},e.createElement(h,null)))},e.createElement(C,{size:"small",header:!1,footer:!1,dataSource:t==null?void 0:t.stages,renderItem:(i,p)=>e.createElement(G,{index:p,stage:i,stages:(t==null?void 0:t.stages)??[],handleEditClick:y=>{r(!0),c(y)}})})),e.createElement(U,{isModalOpen:l,closeModal:()=>o(!1),handleSubmit:()=>{console.log("qwe")},pipeline:n}),e.createElement(z,{isModalOpen:s,closeModal:()=>r(!1),handleSubmit:()=>{console.log("qwe")},pipelineId:t.id,stage:u}))},Z=()=>{const{data:t,isLoading:l}=_();return A.useEffect(()=>(document.title="Deal Pipeline Setup - SpeedLead",()=>{}),[]),l?e.createElement(Q,null):e.createElement(e.Fragment,null,t!=null&&t.length?e.createElement(d,{direction:"vertical",style:{width:"100%"}},t==null?void 0:t.map((o,n)=>e.createElement(Y,{pipeline:o}))):e.createElement(q,null,e.createElement(f.Empty,{image:f.Empty.PRESENTED_IMAGE_SIMPLE})))};export{Z as default};
